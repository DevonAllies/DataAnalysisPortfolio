{"title":"TBTrends:","markdown":{"yaml":{"title":"TBTrends:","author":"Devon Allies","bibliography":"references.bib","csl":"harvard-anglia-ruskin-university.csl"},"headingText":"Introduction:","containsRefs":false,"markdown":"\n\n\nTuberculosis (TB) remains a significant global health challenge, affecting millions of people worldwide, particularly in Africa, Asia, and Latin America. The World Health Organization (WHO) adopted a blueprint in 2014, the `End TB Strategy`, which aims to reduce incidence by 80% by the year 2030, using the year 2015 as a baseline.\n\nThis project conducts an exploratory data analysis (EDA) of the `Tuberculosis_Trends.csv` [@Kyada2024TB] dataset available on `Kaggle`, which captures comprehensive country-level public health data from `2000 - 2024`. The primary objective is to uncover patterns and relationships between TB indicators (cases, mortality, treatment success) and various socio-economic and health infrastructure metrics to identify key drivers of disease prevalence. Specifically, this analysis aims to answer:\n\n-   How have TB cases and deaths trended in South Africa compared to other regions?\n\n-   What socio-economic or health infrastructure factors show the strongest correlation with reduced TB burden?\n\n-   Does the current trajectory indicate South Africa will meet the 2030 reduction targets?\n\n## Import modules:\n\nAnalysis was conducted primarily using Python, leveraging key libraries from the scientific Python ecosystem: **pandas** [@reback2020pandas] for data manipulation, **Numpy** [@harris2020array] for numerical operations, **Seaborn** [@Waskom2021], **Matplotlib** [@Hunter:2007] for visualization, and **SciPy** [@2020SciPy-NMeth] for scientific computing.\n\nThe following script outlines the necessary modules imported to facilitate the project's data processing and exploratory visualization stages:\n\n```{r}\n#| label: r-setup\n#| echo: false\n#| message: false\n#| warning: false\n#| results: 'hide'\n\n# load reticulate package\nlibrary(reticulate)\n\n```\n\n```{python}\n#| label: import_modules\n#| warnings: false\n#| message: false\n\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport math\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as ticker\nsns.set()\n\nfrom sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import mean_squared_error\nfrom statsmodels.tsa.holtwinters import ExponentialSmoothing\n```\n\n## Load dataset:\n\nThis step involves loading the raw `Tuberculosis_Trends.csv` file into a structured data format using the `pandas` module. The `pd.read_csv()` function is used to read the data from the local file path into a DataFrame named `data` for subsequent analysis. This action transforms the raw comma-separated values into a manipulable table.\n\n```{python}\n#| label: import_data\n#| warning: false\n#| message: false\n\ndata = pd.read_csv('Tuberculosis_Trends.csv')\n```\n\n## Data Scope and Key Variables:\n\n```{python}\n#| label: tbl-data-info \n#| echo: false\n#| tbl-cap: 'Dataset feature descriptions, data types, and non-null counts.'\n#| tbl-pos: 'H'\n\ndata.info()\n```\n\nAn initial overview of the column information confirms a robust dataset, providing ample scope for exploring complex relationships. For this project, key variables of interest include `TB_Incidence_Rate`, `TB_Mortality_Rate`, `GDP_Per_Capita`, `Health_Expenditure_Per_Capita`, and `BCG_Vaccination_Coverage`, as these directly relate to potential drivers of disease prevaence outlined in the problem statement.\n\n### Data quality Assessment:\n\n```{python}\n#| label: tbl-missing-values\n#| echo: false\n#| warning: false\n#| message: false\n#| tbl-cap: 'Confirmation of zero missing values across all 22 features, ensuring high data reliability.'\n#| tbl-pos: 'H'\n#| output: axis\n\ndata.isnull().sum()\n```\n\nThis high quality is a significant advantage, as real-world health data is often messy. The completeness of the data for this analysis minimizes potential biases from imputation methods and strengthens the reliability of all subsequent findings and the predictive model's accuracy.\n\n```{python}\n#| echo: false\n#| label: fig-region-cases\n#| fig-cap: 'TB cases over time (2000 - 2024), illustrating persistent disparities between Asia / Africa (high) and North America / Europe (low).'\n#| fig-pos: 'H'\n\n# Set style to whitespace\nsns.set_style('white')\n\nplt.figure(figsize=(14,8))\nax = sns.lineplot(data = data, x = 'Year', y = 'TB_Cases', hue = 'Region')\nplt.title('TB Cases Over Time, Grouped by Region', fontsize = 16, fontweight = 'bold')\nplt.xlabel('') # Empty x-label\nplt.ylabel('TB Cases', fontsize = 13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nplt.legend(title = 'Region', bbox_to_anchor=(1.05, 1 ), loc = 'upper left', fontsize = 13)\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\nThe persistent disparity between high-burden regions (Asia, Africa) and low-burden regions (North America, Europe) underscores the critical need for targeted, context-specific interventions. This initial observation justifies a deeper dive into country-level socio-economic factors (e.g., GDP, health expenditure) to understand the drivers behind these regional differences, rather than just observing them.\n\n```{python}\n#| echo: false\n#| label: fig-south-africa-cases\n#| fig-cap: 'Annual TB cases in South Africa (2000 - 2024), showing fluctuation with a slight downward trend.'\n#| fig-pos: 'H'\n\nsns.set_style('white')\n\nsouth_africa = data[data['Country'] == 'South Africa']\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'TB_Cases')\nplt.title('South Africa TB Cases', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('TB Cases', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n```{python}\n#| label: fig-deaths\n#| echo: false\n#| fig-cap: 'Annual TB deaths in South Africa (2000 - 2024).'\n#| fig-pos: 'H'\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'TB_Deaths')\nplt.title('South Africa TB_Deaths', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('TB Deaths', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n@fig-south-africa-cases and @fig-deaths provide a granular view of South Africa. While TB cases have fluctuated, there is a general trend of decreasing TB deaths since the early 2000s, indicating potential improvements in treatment efficacy or access to care.\n\nThe official death counts can be complex due to reporting issues (e.g., HIV and TB are often under-reported on death certificates).\n\n```{python}\n#| label: fig-drug-res\n#| echo: false\n#| fig-cap: ' Drug Resistant TB Cases observed in South Africa.'\n#| fig-pos: 'H'\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'Drug_Resistant_TB_Cases')\nplt.title('South Africa Drug Resistant TB Cases', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('Drug Resistant TB Cases', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n```{python}\n#| label: fig-hiv-tb\n#| echo: false\n#| fig-cap: 'HIV Co-Infected TB Cases observed in South Africa.'\n#| fig-pos: 'H'\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'HIV_CoInfected_TB_Cases')\nplt.title('South Africa HIV Co-infected TB Cases', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('HIV Co-Infected TB Cases', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n@fig-drug-res and @fig-hiv-tb highlights the persistent challenges of drug-resistant TB and HIV co-infection within South Africa. The trends for HIV co-infected cases show considerable variability, with peaks around 2005 and 2015, suggesting a need for targeted interventions.\n\n## Determining Correlation:\n\n```{python}\n#| label: fig-cor-heatmap\n#| echo: false\n#| fig-pos: 'H'\n#| fig-cap: \"Pearson correlation matrix for South Africa's health metrics; Access to Health Services shows the strongest negative correlation with TB Deaths.\"\n\n# Select only numeric columns\nnum_south_africa = south_africa.select_dtypes(include=['number'])\n\ncorrelation_matrix = num_south_africa.corr(method='pearson')\n\n# Plot the heatmap\nplt.figure(figsize=(12,8))\nsns.heatmap(correlation_matrix, annot = True, cmap = 'coolwarm', fmt = '.2f', linewidth = 0.5)\nplt.title('Correlation Heatmap of South Africa')\nplt.tight_layout()\nplt.show()\n```\n\n@fig-cor-heatmap presents a correlation heatmap generated from the Pearson correlation coefficients calculated for South Africa's data.\n\nThe observed weak correlations for most variables are typical of complex, multifactorial public health issues, highlighting that no single factor operates in isolation.\n\nThe strongest correlation observed in South Africa is the negative relationship between `Access_To_Health_Services` and `TB_Deaths`. This insight is a key takeaway: increasing access to care is potentially the single most impactful structural intervention for reducing TB mortality, which can directly inform policy and resource allocation.\n\n## Predictive Modeling:\n\n```{python}\n#| label: tbl-hypertuning\n#| echo: false\n#| tbl-pos: 'H'\n#| tab-cap: 'Feature Selection and Split size.'\n#| output: asis\n\n# Define target variable\ny = south_africa['TB_Cases']\n\n# Define features by dropping the target column\nX = south_africa.drop('TB_Cases', axis = 1)\n\n# Ensure X only contains numeric data for the model\nX = X.select_dtypes(include=['number'])\nfeatures_table = pd.DataFrame(X.columns, columns=['Features Used in Model (X)'])\nprint(features_table.to_markdown(index=False))\n\n# Split data into training and test\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = .30, random_state = 12345)\n\n```\n\nTo move beyond exploratory analysis and assess the potential for forecasting disease burden, a Random Forest Regressor model was trained to predict `TB_Cases` in South Africa. The dataset was split into training and testing sets.\n\n```{python}\n#| label: tbl-gridsearch\n#| echo: false\n#| tbl-pos: 'H'\n#| tbl-cap: 'Hypertuning Results using GridSearchCV'\n\n# Define the parameter grid\nparam_grid = {\n  'n_estimators': [50, 100, 150, 200],\n  'max_depth': [None, 10, 20, 30],\n  'min_samples_split': [2, 5, 10]\n}\n\n# Initialize the base Random Forest Regressor model\nrf = RandomForestRegressor(random_state = 12345)\n\n# Initialize GridSearchCV\ngrid_search = GridSearchCV(\n  estimator = rf,\n  param_grid=param_grid,\n  cv = 5,\n  scoring = 'neg_mean_squared_error'\n)\n\n# Perform the tuning\ngrid_search.fit(X_train, y_train)\n\n# Get the dictionary of the best parameters\nbest_params_dict = grid_search.best_params_\n\n# Convert dictionary into a pandas dataframe\nparams_df = pd.DataFrame([best_params_dict]).T # Transpose\n\n# Rname the column for clarity\nparams_df.columns = ['Optimal Value']\nparams_df.index.name = 'Hyperparameter'\n\n# Display Optimal Paramters and Final Evaluation\nprint(params_df.to_markdown(index=True))\n```\n\n`GridSearchCV` was employed to systematically identify the optimal model configuration, balancing predictive accuracy with the risk of overfitting. The finalized hyperparameters (max depth 10, min samples split 10, n_estimators 50) ensure the model provides robust, generalized predictions.\n\n```{python}\n#| label: prediction\n#| echo: false\n\n# Retrieved the best model found by the grid search\nbest_rf_model = grid_search.best_estimator_\n\n# Evaluate the best model on the unseen test set\npredictions = best_rf_model.predict(X_test)\nfinal_mse = mean_squared_error(y_test, predictions)\nfinal_rmse = np.sqrt(final_mse)\n```\n\n```{python}\n#| echo: false\n#| label: fig-feature-selection\n#| fig-cap: 'Feature importance for predicting TB cases; Population, Treatment Success Rate, and GDP per Capita are identified as key drivers.'\n#| fig-pos: 'H'\n\n# Initialize the base random forest regressor with the hypertuning parameter\nrandom_forest = RandomForestRegressor(\n  n_estimators = 50,\n  max_depth = 10,\n  min_samples_split = 10,\n  random_state = 12345\n  )\n  \nrandom_forest.fit(X_train, y_train)\n\nimportances = random_forest.feature_importances_\nsorted_idx = importances.argsort()\n\nfeature_names = X_train.columns\n\nplt.figure(figsize=(12,8))\nplt.barh(feature_names[sorted_idx], importances[sorted_idx])\nplt.xlabel('Feature Importance')\nplt.title('Random Forest Feature Importance for TB Cases', fontsize = 16, fontweight = 'bold')\nplt.tight_layout()\nplt.show()\n```\n\n@fig-feature-selection illustrates the derived feature importance from the Random Forest model. It highlights that while demographic factors like `Population` are a major driver (naturally, more people mean more cases), actionable health metrics such as `TB_Treatment_Success_Rate`, `GDP_Per_Capita`, and `TB_Deaths` also play roles. These findings may guide resource allocation towards improving treatment outcomes and economic conditions as key strategies for reducing disease prevalence.\n\n## WHO End TB Initiative:\n\nThe WHO End TB Strategy is a global health framework and provides a blueprint for countries to reduce TB incidence and deaths, with a vision of world free of TB.\n\nThe goal is to end the global TB epidemic by achieving specific milestones, including a 90% reduction in TB deaths and a 80% reduction in TB incidence by 2030, compared to 2015 levels.\n\n```{python}\n#| label: end-tb\n#| echo: false\n\ndef forecast_incidence_2030(south_africa_df):\n  INCIDENCE_COL = 'TB_Incidence_Rate'\n  YEAR_COL = 'Year'\n\n  df = south_africa_df.copy()\n  \n  df[YEAR_COL] = pd.to_datetime(df[YEAR_COL], format='%Y')\n  \n  # CRITICAL FIX: Handle duplicate years by averaging the incidence rate\n  df = df.groupby(YEAR_COL)[INCIDENCE_COL].mean().reset_index()\n  \n  # Now set the unique years as the index\n  df.set_index(YEAR_COL, inplace=True)\n  df = df.asfreq('YS')\n  \n  ts = df[INCIDENCE_COL]\n  \n  model = ExponentialSmoothing(ts, trend='add', seasonal=None, initialization_method='estimated')\n  model_fit = model.fit()\n  \n  last_year = ts.index.max().year\n  years_to_forecast = 2030 - last_year\n  \n  forecast_2030_series = model_fit.forecast(steps=years_to_forecast)\n  forecast_2030 = forecast_2030_series.iloc[-1]\n\n  # Return the time series data as a DataFrame using .to_frame() on the Series\n  return forecast_2030, model_fit, forecast_2030_series, ts.to_frame()\n\ndef classify_2030_target_achievement(baseline_rate_2015, predicted_rate_2030):\n  required_reduction_rate = 0.80\n  actual_reduction = (baseline_rate_2015 - predicted_rate_2030) / baseline_rate_2015\n  target_achieved_label = int(actual_reduction >= required_reduction_rate)\n  return target_achieved_label, actual_reduction\n\n# Graphing Function\ndef plot_forecast(ts_data, model_fit, forecast_series, baseline_2015, predicted_2030):\n    plt.figure(figsize=(12, 6))\n    plt.plot(ts_data.index, ts_data['TB_Incidence_Rate'], label='Historical Data', marker='o', color='blue')\n    fitted_dates = model_fit.fittedvalues.index\n    plt.plot(fitted_dates, model_fit.fittedvalues, label='Fitted (In-sample)', linestyle='--', color='green')\n    forecast_dates = forecast_series.index\n    plt.plot(forecast_dates, forecast_series, label='Forecast (Out-of-sample)', linestyle='-', marker='s', color='red')\n    plt.scatter(pd.to_datetime('2015-01-01'), baseline_2015, color='purple', zorder=5, label=f'2015 Baseline ({baseline_2015:.2f})')\n    plt.scatter(pd.to_datetime('2030-01-01'), predicted_2030, color='orange', zorder=5, label=f'2030 Prediction ({predicted_2030:.2f})')\n    target_rate = baseline_2015 * (1 - 0.80)\n    plt.axhline(y=target_rate, color='gray', linestyle=':', label=f'80% Reduction Target ({target_rate:.2f})')\n    plt.title('TB Incidence Rate Forecast for South Africa', fontsize = 16, fontweight = 'bold')\n    plt.xlabel('')\n    plt.ylabel('Cases per 100k Population')\n    plt.legend()\n    plt.grid(True)\n    sns.despine()\n    plt.tight_layout()\n    plt.show()\n\n\n# --- Execution Block ---\n\n# Pass your 'south_africa' DataFrame here.\n# This should now execute without errors if your DataFrame has the 'Year' column\n# and multiple years of data (even with duplicates which are handled above).\npredicted_incidence_2030_sa, model_fit_sa, forecast_series_sa, sa_data_ts = forecast_incidence_2030(south_africa)\n\n# Get the 2015 baseline from the time series data\nbaseline_sa_2015 = sa_data_ts.loc['2015-01-01']['TB_Incidence_Rate']\n\nfinal_status_label, reduction_pct = classify_2030_target_achievement(baseline_sa_2015, predicted_incidence_2030_sa)\n```\n\n```{python}\n#| label: inc_predictions\n#| echo: false\n\nprint(f\"Predicted incidence for 2030: {predicted_incidence_2030_sa:.2f}\")\nprint(f\"2015 Baseline: {baseline_sa_2015:.2f}\")\nprint(f\"Achieved Reduction Percentage: {reduction_pct*100:.2f}%\")\nprint(f\"Target Achieved Status (1 = Achieved, 0 = Not Achieved): {final_status_label}\")\n```\n\n```{python}\n#| label: fig-forecasting\n#| echo: false\n#| fig-pos: 'H'\n#| fig-cap: 'Time Series Forecase determining whether South Africa would reach the 80% reduction.'\n\n# Display the graph\nplot_forecast(sa_data_ts, model_fit_sa, forecast_series_sa, baseline_sa_2015, predicted_incidence_2030_sa)\n```\n\n## Conclusion and Actionable Recommendations:\n\nThis exploratory data analysis and predictive modeling project successfully identified key drivers of tuberculosis prevalence in South Africa and forecasted potential future trends. The analysis highlights that South Africa, under its current trajectory, is not projected to meet the ambitious 80% TB incidence reduction target by 2030.\n\n**Key Takeaways and Insights:**\n\n-   The strongest negative correlation was found between `Access_To_Health_Services` and `TB_Deaths`.\n\n-   `GDP_Per_Capita` and `TB_Treatment_Success_Rate` were significant features in predicting TB cases, along with general population density.\n\n-   The high variability of HIV co-infected cases highlights a need for better integrated screening and treatment programs.\n\n**Next Steps:**\n\nFuture work will involve validating the insights found here by analyzing the official WHO Global TB Report dataset, as the current analysis utilizes a similar but separate dataset obtained via Kaggle. Additionally, future analysis could incorporate more granular geographic data to identify specific TB hotspots, perform cost-effectiveness analysis for the recommended interventions, or explore more advanced time-series models to refine long-term forecasting.\n\n**Limitations:**\n\n-   The analysis utilized a dataset obtained via Kaggle, which is similar to but separate from the official WHO Global TB Report dataset. Future work would involve validating these insights against the official WHO data.\n\n-   The correlation analysis and predictive modeling were specifically conducted using data only for South Africa, limiting the immediate generalizability of these specific findings to other countries or regions.\n\n-   Official death counts can be complex due to reporting issues (e.g., HIV and TB are often under-reported on death certificates), which may introduce some bias into the historical data.\n\n-   While a Random Forest Regressor was used, future analysis could explore more advanced time-series models to refine long-term forecasting accuracy.\n\n### License and Data Usage Terms:\n\nThe underlying data used in this analysis, *Tuberculosis Trends - Global & Regional Insights by Khushi Kyada* is provided under the [**Creative Commons Attribution 4.0 International License (CC BY 4.0)**](https://creativecommons.org/licenses/by/4.0/)**.**\n\nAll original source code and analytical work presented in this project is released under the **MIT License**. A copy of this license is available in the root directory of the project repository (`License.txt` file). This license grants permission for commercial and non-commercial use, modification, and distribution of the project's software, provided appropriate credit is given.\n\n## References:\n","srcMarkdownNoYaml":"\n\n## Introduction:\n\nTuberculosis (TB) remains a significant global health challenge, affecting millions of people worldwide, particularly in Africa, Asia, and Latin America. The World Health Organization (WHO) adopted a blueprint in 2014, the `End TB Strategy`, which aims to reduce incidence by 80% by the year 2030, using the year 2015 as a baseline.\n\nThis project conducts an exploratory data analysis (EDA) of the `Tuberculosis_Trends.csv` [@Kyada2024TB] dataset available on `Kaggle`, which captures comprehensive country-level public health data from `2000 - 2024`. The primary objective is to uncover patterns and relationships between TB indicators (cases, mortality, treatment success) and various socio-economic and health infrastructure metrics to identify key drivers of disease prevalence. Specifically, this analysis aims to answer:\n\n-   How have TB cases and deaths trended in South Africa compared to other regions?\n\n-   What socio-economic or health infrastructure factors show the strongest correlation with reduced TB burden?\n\n-   Does the current trajectory indicate South Africa will meet the 2030 reduction targets?\n\n## Import modules:\n\nAnalysis was conducted primarily using Python, leveraging key libraries from the scientific Python ecosystem: **pandas** [@reback2020pandas] for data manipulation, **Numpy** [@harris2020array] for numerical operations, **Seaborn** [@Waskom2021], **Matplotlib** [@Hunter:2007] for visualization, and **SciPy** [@2020SciPy-NMeth] for scientific computing.\n\nThe following script outlines the necessary modules imported to facilitate the project's data processing and exploratory visualization stages:\n\n```{r}\n#| label: r-setup\n#| echo: false\n#| message: false\n#| warning: false\n#| results: 'hide'\n\n# load reticulate package\nlibrary(reticulate)\n\n```\n\n```{python}\n#| label: import_modules\n#| warnings: false\n#| message: false\n\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport math\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as ticker\nsns.set()\n\nfrom sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import mean_squared_error\nfrom statsmodels.tsa.holtwinters import ExponentialSmoothing\n```\n\n## Load dataset:\n\nThis step involves loading the raw `Tuberculosis_Trends.csv` file into a structured data format using the `pandas` module. The `pd.read_csv()` function is used to read the data from the local file path into a DataFrame named `data` for subsequent analysis. This action transforms the raw comma-separated values into a manipulable table.\n\n```{python}\n#| label: import_data\n#| warning: false\n#| message: false\n\ndata = pd.read_csv('Tuberculosis_Trends.csv')\n```\n\n## Data Scope and Key Variables:\n\n```{python}\n#| label: tbl-data-info \n#| echo: false\n#| tbl-cap: 'Dataset feature descriptions, data types, and non-null counts.'\n#| tbl-pos: 'H'\n\ndata.info()\n```\n\nAn initial overview of the column information confirms a robust dataset, providing ample scope for exploring complex relationships. For this project, key variables of interest include `TB_Incidence_Rate`, `TB_Mortality_Rate`, `GDP_Per_Capita`, `Health_Expenditure_Per_Capita`, and `BCG_Vaccination_Coverage`, as these directly relate to potential drivers of disease prevaence outlined in the problem statement.\n\n### Data quality Assessment:\n\n```{python}\n#| label: tbl-missing-values\n#| echo: false\n#| warning: false\n#| message: false\n#| tbl-cap: 'Confirmation of zero missing values across all 22 features, ensuring high data reliability.'\n#| tbl-pos: 'H'\n#| output: axis\n\ndata.isnull().sum()\n```\n\nThis high quality is a significant advantage, as real-world health data is often messy. The completeness of the data for this analysis minimizes potential biases from imputation methods and strengthens the reliability of all subsequent findings and the predictive model's accuracy.\n\n```{python}\n#| echo: false\n#| label: fig-region-cases\n#| fig-cap: 'TB cases over time (2000 - 2024), illustrating persistent disparities between Asia / Africa (high) and North America / Europe (low).'\n#| fig-pos: 'H'\n\n# Set style to whitespace\nsns.set_style('white')\n\nplt.figure(figsize=(14,8))\nax = sns.lineplot(data = data, x = 'Year', y = 'TB_Cases', hue = 'Region')\nplt.title('TB Cases Over Time, Grouped by Region', fontsize = 16, fontweight = 'bold')\nplt.xlabel('') # Empty x-label\nplt.ylabel('TB Cases', fontsize = 13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nplt.legend(title = 'Region', bbox_to_anchor=(1.05, 1 ), loc = 'upper left', fontsize = 13)\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\nThe persistent disparity between high-burden regions (Asia, Africa) and low-burden regions (North America, Europe) underscores the critical need for targeted, context-specific interventions. This initial observation justifies a deeper dive into country-level socio-economic factors (e.g., GDP, health expenditure) to understand the drivers behind these regional differences, rather than just observing them.\n\n```{python}\n#| echo: false\n#| label: fig-south-africa-cases\n#| fig-cap: 'Annual TB cases in South Africa (2000 - 2024), showing fluctuation with a slight downward trend.'\n#| fig-pos: 'H'\n\nsns.set_style('white')\n\nsouth_africa = data[data['Country'] == 'South Africa']\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'TB_Cases')\nplt.title('South Africa TB Cases', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('TB Cases', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n```{python}\n#| label: fig-deaths\n#| echo: false\n#| fig-cap: 'Annual TB deaths in South Africa (2000 - 2024).'\n#| fig-pos: 'H'\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'TB_Deaths')\nplt.title('South Africa TB_Deaths', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('TB Deaths', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n@fig-south-africa-cases and @fig-deaths provide a granular view of South Africa. While TB cases have fluctuated, there is a general trend of decreasing TB deaths since the early 2000s, indicating potential improvements in treatment efficacy or access to care.\n\nThe official death counts can be complex due to reporting issues (e.g., HIV and TB are often under-reported on death certificates).\n\n```{python}\n#| label: fig-drug-res\n#| echo: false\n#| fig-cap: ' Drug Resistant TB Cases observed in South Africa.'\n#| fig-pos: 'H'\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'Drug_Resistant_TB_Cases')\nplt.title('South Africa Drug Resistant TB Cases', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('Drug Resistant TB Cases', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n```{python}\n#| label: fig-hiv-tb\n#| echo: false\n#| fig-cap: 'HIV Co-Infected TB Cases observed in South Africa.'\n#| fig-pos: 'H'\n\nplt.figure(figsize=(12,6))\nax = sns.lineplot(data = south_africa, x = 'Year', y = 'HIV_CoInfected_TB_Cases')\nplt.title('South Africa HIV Co-infected TB Cases', fontsize = 16, fontweight = 'bold')\nplt.xlabel('')\nplt.ylabel('HIV Co-Infected TB Cases', fontsize=13)\nax.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))\nsns.despine()\nplt.tight_layout()\nplt.show()\n```\n\n@fig-drug-res and @fig-hiv-tb highlights the persistent challenges of drug-resistant TB and HIV co-infection within South Africa. The trends for HIV co-infected cases show considerable variability, with peaks around 2005 and 2015, suggesting a need for targeted interventions.\n\n## Determining Correlation:\n\n```{python}\n#| label: fig-cor-heatmap\n#| echo: false\n#| fig-pos: 'H'\n#| fig-cap: \"Pearson correlation matrix for South Africa's health metrics; Access to Health Services shows the strongest negative correlation with TB Deaths.\"\n\n# Select only numeric columns\nnum_south_africa = south_africa.select_dtypes(include=['number'])\n\ncorrelation_matrix = num_south_africa.corr(method='pearson')\n\n# Plot the heatmap\nplt.figure(figsize=(12,8))\nsns.heatmap(correlation_matrix, annot = True, cmap = 'coolwarm', fmt = '.2f', linewidth = 0.5)\nplt.title('Correlation Heatmap of South Africa')\nplt.tight_layout()\nplt.show()\n```\n\n@fig-cor-heatmap presents a correlation heatmap generated from the Pearson correlation coefficients calculated for South Africa's data.\n\nThe observed weak correlations for most variables are typical of complex, multifactorial public health issues, highlighting that no single factor operates in isolation.\n\nThe strongest correlation observed in South Africa is the negative relationship between `Access_To_Health_Services` and `TB_Deaths`. This insight is a key takeaway: increasing access to care is potentially the single most impactful structural intervention for reducing TB mortality, which can directly inform policy and resource allocation.\n\n## Predictive Modeling:\n\n```{python}\n#| label: tbl-hypertuning\n#| echo: false\n#| tbl-pos: 'H'\n#| tab-cap: 'Feature Selection and Split size.'\n#| output: asis\n\n# Define target variable\ny = south_africa['TB_Cases']\n\n# Define features by dropping the target column\nX = south_africa.drop('TB_Cases', axis = 1)\n\n# Ensure X only contains numeric data for the model\nX = X.select_dtypes(include=['number'])\nfeatures_table = pd.DataFrame(X.columns, columns=['Features Used in Model (X)'])\nprint(features_table.to_markdown(index=False))\n\n# Split data into training and test\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = .30, random_state = 12345)\n\n```\n\nTo move beyond exploratory analysis and assess the potential for forecasting disease burden, a Random Forest Regressor model was trained to predict `TB_Cases` in South Africa. The dataset was split into training and testing sets.\n\n```{python}\n#| label: tbl-gridsearch\n#| echo: false\n#| tbl-pos: 'H'\n#| tbl-cap: 'Hypertuning Results using GridSearchCV'\n\n# Define the parameter grid\nparam_grid = {\n  'n_estimators': [50, 100, 150, 200],\n  'max_depth': [None, 10, 20, 30],\n  'min_samples_split': [2, 5, 10]\n}\n\n# Initialize the base Random Forest Regressor model\nrf = RandomForestRegressor(random_state = 12345)\n\n# Initialize GridSearchCV\ngrid_search = GridSearchCV(\n  estimator = rf,\n  param_grid=param_grid,\n  cv = 5,\n  scoring = 'neg_mean_squared_error'\n)\n\n# Perform the tuning\ngrid_search.fit(X_train, y_train)\n\n# Get the dictionary of the best parameters\nbest_params_dict = grid_search.best_params_\n\n# Convert dictionary into a pandas dataframe\nparams_df = pd.DataFrame([best_params_dict]).T # Transpose\n\n# Rname the column for clarity\nparams_df.columns = ['Optimal Value']\nparams_df.index.name = 'Hyperparameter'\n\n# Display Optimal Paramters and Final Evaluation\nprint(params_df.to_markdown(index=True))\n```\n\n`GridSearchCV` was employed to systematically identify the optimal model configuration, balancing predictive accuracy with the risk of overfitting. The finalized hyperparameters (max depth 10, min samples split 10, n_estimators 50) ensure the model provides robust, generalized predictions.\n\n```{python}\n#| label: prediction\n#| echo: false\n\n# Retrieved the best model found by the grid search\nbest_rf_model = grid_search.best_estimator_\n\n# Evaluate the best model on the unseen test set\npredictions = best_rf_model.predict(X_test)\nfinal_mse = mean_squared_error(y_test, predictions)\nfinal_rmse = np.sqrt(final_mse)\n```\n\n```{python}\n#| echo: false\n#| label: fig-feature-selection\n#| fig-cap: 'Feature importance for predicting TB cases; Population, Treatment Success Rate, and GDP per Capita are identified as key drivers.'\n#| fig-pos: 'H'\n\n# Initialize the base random forest regressor with the hypertuning parameter\nrandom_forest = RandomForestRegressor(\n  n_estimators = 50,\n  max_depth = 10,\n  min_samples_split = 10,\n  random_state = 12345\n  )\n  \nrandom_forest.fit(X_train, y_train)\n\nimportances = random_forest.feature_importances_\nsorted_idx = importances.argsort()\n\nfeature_names = X_train.columns\n\nplt.figure(figsize=(12,8))\nplt.barh(feature_names[sorted_idx], importances[sorted_idx])\nplt.xlabel('Feature Importance')\nplt.title('Random Forest Feature Importance for TB Cases', fontsize = 16, fontweight = 'bold')\nplt.tight_layout()\nplt.show()\n```\n\n@fig-feature-selection illustrates the derived feature importance from the Random Forest model. It highlights that while demographic factors like `Population` are a major driver (naturally, more people mean more cases), actionable health metrics such as `TB_Treatment_Success_Rate`, `GDP_Per_Capita`, and `TB_Deaths` also play roles. These findings may guide resource allocation towards improving treatment outcomes and economic conditions as key strategies for reducing disease prevalence.\n\n## WHO End TB Initiative:\n\nThe WHO End TB Strategy is a global health framework and provides a blueprint for countries to reduce TB incidence and deaths, with a vision of world free of TB.\n\nThe goal is to end the global TB epidemic by achieving specific milestones, including a 90% reduction in TB deaths and a 80% reduction in TB incidence by 2030, compared to 2015 levels.\n\n```{python}\n#| label: end-tb\n#| echo: false\n\ndef forecast_incidence_2030(south_africa_df):\n  INCIDENCE_COL = 'TB_Incidence_Rate'\n  YEAR_COL = 'Year'\n\n  df = south_africa_df.copy()\n  \n  df[YEAR_COL] = pd.to_datetime(df[YEAR_COL], format='%Y')\n  \n  # CRITICAL FIX: Handle duplicate years by averaging the incidence rate\n  df = df.groupby(YEAR_COL)[INCIDENCE_COL].mean().reset_index()\n  \n  # Now set the unique years as the index\n  df.set_index(YEAR_COL, inplace=True)\n  df = df.asfreq('YS')\n  \n  ts = df[INCIDENCE_COL]\n  \n  model = ExponentialSmoothing(ts, trend='add', seasonal=None, initialization_method='estimated')\n  model_fit = model.fit()\n  \n  last_year = ts.index.max().year\n  years_to_forecast = 2030 - last_year\n  \n  forecast_2030_series = model_fit.forecast(steps=years_to_forecast)\n  forecast_2030 = forecast_2030_series.iloc[-1]\n\n  # Return the time series data as a DataFrame using .to_frame() on the Series\n  return forecast_2030, model_fit, forecast_2030_series, ts.to_frame()\n\ndef classify_2030_target_achievement(baseline_rate_2015, predicted_rate_2030):\n  required_reduction_rate = 0.80\n  actual_reduction = (baseline_rate_2015 - predicted_rate_2030) / baseline_rate_2015\n  target_achieved_label = int(actual_reduction >= required_reduction_rate)\n  return target_achieved_label, actual_reduction\n\n# Graphing Function\ndef plot_forecast(ts_data, model_fit, forecast_series, baseline_2015, predicted_2030):\n    plt.figure(figsize=(12, 6))\n    plt.plot(ts_data.index, ts_data['TB_Incidence_Rate'], label='Historical Data', marker='o', color='blue')\n    fitted_dates = model_fit.fittedvalues.index\n    plt.plot(fitted_dates, model_fit.fittedvalues, label='Fitted (In-sample)', linestyle='--', color='green')\n    forecast_dates = forecast_series.index\n    plt.plot(forecast_dates, forecast_series, label='Forecast (Out-of-sample)', linestyle='-', marker='s', color='red')\n    plt.scatter(pd.to_datetime('2015-01-01'), baseline_2015, color='purple', zorder=5, label=f'2015 Baseline ({baseline_2015:.2f})')\n    plt.scatter(pd.to_datetime('2030-01-01'), predicted_2030, color='orange', zorder=5, label=f'2030 Prediction ({predicted_2030:.2f})')\n    target_rate = baseline_2015 * (1 - 0.80)\n    plt.axhline(y=target_rate, color='gray', linestyle=':', label=f'80% Reduction Target ({target_rate:.2f})')\n    plt.title('TB Incidence Rate Forecast for South Africa', fontsize = 16, fontweight = 'bold')\n    plt.xlabel('')\n    plt.ylabel('Cases per 100k Population')\n    plt.legend()\n    plt.grid(True)\n    sns.despine()\n    plt.tight_layout()\n    plt.show()\n\n\n# --- Execution Block ---\n\n# Pass your 'south_africa' DataFrame here.\n# This should now execute without errors if your DataFrame has the 'Year' column\n# and multiple years of data (even with duplicates which are handled above).\npredicted_incidence_2030_sa, model_fit_sa, forecast_series_sa, sa_data_ts = forecast_incidence_2030(south_africa)\n\n# Get the 2015 baseline from the time series data\nbaseline_sa_2015 = sa_data_ts.loc['2015-01-01']['TB_Incidence_Rate']\n\nfinal_status_label, reduction_pct = classify_2030_target_achievement(baseline_sa_2015, predicted_incidence_2030_sa)\n```\n\n```{python}\n#| label: inc_predictions\n#| echo: false\n\nprint(f\"Predicted incidence for 2030: {predicted_incidence_2030_sa:.2f}\")\nprint(f\"2015 Baseline: {baseline_sa_2015:.2f}\")\nprint(f\"Achieved Reduction Percentage: {reduction_pct*100:.2f}%\")\nprint(f\"Target Achieved Status (1 = Achieved, 0 = Not Achieved): {final_status_label}\")\n```\n\n```{python}\n#| label: fig-forecasting\n#| echo: false\n#| fig-pos: 'H'\n#| fig-cap: 'Time Series Forecase determining whether South Africa would reach the 80% reduction.'\n\n# Display the graph\nplot_forecast(sa_data_ts, model_fit_sa, forecast_series_sa, baseline_sa_2015, predicted_incidence_2030_sa)\n```\n\n## Conclusion and Actionable Recommendations:\n\nThis exploratory data analysis and predictive modeling project successfully identified key drivers of tuberculosis prevalence in South Africa and forecasted potential future trends. The analysis highlights that South Africa, under its current trajectory, is not projected to meet the ambitious 80% TB incidence reduction target by 2030.\n\n**Key Takeaways and Insights:**\n\n-   The strongest negative correlation was found between `Access_To_Health_Services` and `TB_Deaths`.\n\n-   `GDP_Per_Capita` and `TB_Treatment_Success_Rate` were significant features in predicting TB cases, along with general population density.\n\n-   The high variability of HIV co-infected cases highlights a need for better integrated screening and treatment programs.\n\n**Next Steps:**\n\nFuture work will involve validating the insights found here by analyzing the official WHO Global TB Report dataset, as the current analysis utilizes a similar but separate dataset obtained via Kaggle. Additionally, future analysis could incorporate more granular geographic data to identify specific TB hotspots, perform cost-effectiveness analysis for the recommended interventions, or explore more advanced time-series models to refine long-term forecasting.\n\n**Limitations:**\n\n-   The analysis utilized a dataset obtained via Kaggle, which is similar to but separate from the official WHO Global TB Report dataset. Future work would involve validating these insights against the official WHO data.\n\n-   The correlation analysis and predictive modeling were specifically conducted using data only for South Africa, limiting the immediate generalizability of these specific findings to other countries or regions.\n\n-   Official death counts can be complex due to reporting issues (e.g., HIV and TB are often under-reported on death certificates), which may introduce some bias into the historical data.\n\n-   While a Random Forest Regressor was used, future analysis could explore more advanced time-series models to refine long-term forecasting accuracy.\n\n### License and Data Usage Terms:\n\nThe underlying data used in this analysis, *Tuberculosis Trends - Global & Regional Insights by Khushi Kyada* is provided under the [**Creative Commons Attribution 4.0 International License (CC BY 4.0)**](https://creativecommons.org/licenses/by/4.0/)**.**\n\nAll original source code and analytical work presented in this project is released under the **MIT License**. A copy of this license is available in the root directory of the project repository (`License.txt` file). This license grants permission for commercial and non-commercial use, modification, and distribution of the project's software, provided appropriate credit is given.\n\n## References:\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"TBTrendsEDA.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.27","theme":["cosmo","brand"],"title":"TBTrends:","author":"Devon Allies","bibliography":["references.bib"],"csl":"harvard-anglia-ruskin-university.csl"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}